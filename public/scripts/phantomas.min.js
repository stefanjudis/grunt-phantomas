!function(d3,window,document){function addEvent(obj,type,fn){obj.attachEvent?(obj["e"+type+fn]=fn,obj[type+fn]=function(){obj["e"+type+fn](window.event)},obj.attachEvent("on"+type,obj[type+fn])):obj.addEventListener(type,fn,!1)}function getParent(el,className){for(var parent=null,p=el.parentNode;null!==p;){var o=p;if(o.classList.contains(className)){parent=o;break}p=o.parentNode}return parent}function drawLineChart(data,metric){function drawCircle(datum,index){circleContainer.datum(datum).append("circle").attr("class","lineChart--circle").attr("r",0).attr("cx",function(d){return x(d.date)+detailWidth/2}).attr("cy",function(d){return y(d.value)}).attr("data-value",function(d){return d.value}).on("mouseenter",function(){d3.select(this).attr("class","lineChart--circle lineChart--circle__highlighted").attr("r",4)}).on("mouseout",function(){d3.select(this).attr("class","lineChart--circle").attr("r",3)}).transition().delay(DURATION/10*index).attr("r",3)}function drawCircles(data){circleContainer=svg.append("g"),data.forEach(function(datum,index){drawCircle(datum,index)})}function tween(b,callback){return function(a){var i=function(){return function(t){return a.map(function(datum,index){return{date:datum.date,value:datum.value+b[index].value*t}})}}();return function(t){return callback(i(t))}}}data=data.map(function(datum){return{date:new Date(datum.timestamp),value:datum.metrics[metric]}});var circleContainer,containerEl=document.getElementById("graph--"+metric),width=containerEl.clientWidth,height=.4*width,margin={top:20,right:10,bottom:10,left:10},detailWidth=98,container=d3.select(containerEl),svg=container.append("svg").attr("width",width).attr("height",height+margin.top+margin.bottom),x=d3.time.scale().range([0,width-detailWidth]),xAxis=d3.svg.axis().scale(x).ticks(8).tickSize(-height),xAxisTicks=d3.svg.axis().scale(x).ticks(16).tickSize(-height).tickFormat(""),y=d3.scale.linear().range([height,0]),yAxisTicks=d3.svg.axis().scale(y).ticks(12).tickSize(width).tickFormat("").orient("right"),area=d3.svg.area().interpolate("linear").x(function(d){return x(d.date)+detailWidth/2}).y0(height).y1(function(d){return y(d.value)}),line=d3.svg.line().interpolate("linear").x(function(d){return x(d.date)+detailWidth/2}).y(function(d){return y(d.value)}),startData=data.map(function(datum){return{date:datum.date,value:0}});x.domain([data[0].date,data[data.length-1].date]),y.domain([0,d3.max(data,function(d){return d.value})+700]),svg.append("g").attr("class","lineChart--xAxisTicks").attr("transform","translate("+detailWidth/2+","+height+")").call(xAxisTicks),svg.append("g").attr("class","lineChart--xAxis").attr("transform","translate("+detailWidth/2+","+(height+7)+")").call(xAxis),svg.append("g").attr("class","lineChart--yAxisTicks").call(yAxisTicks),svg.append("path").datum(startData).attr("class","p--lineChart--area").attr("d",area).transition().duration(DURATION).attrTween("d",tween(data,area)),svg.append("path").datum(startData).attr("class","p--lineChart--areaLine").attr("d",line).transition().duration(DURATION).delay(DURATION/2).attrTween("d",tween(data,line)).each("end",function(){drawCircles(data)})}function appendDetailBoxForCircle(circle){var bBox=circle.getBBox(),detailBox=document.createElement("div"),listContainer=getParent(circle,"p--graphs--graph");detailBox.innerHTML=circle.dataset.value,detailBox.style.left=bBox.x-36+"px",detailBox.style.top=bBox.y+10+"px",detailBox.classList.add("p--graphs--detailBox"),listContainer.appendChild(detailBox)}function removeDetailBoxForCircle(circle){var listContainer=getParent(circle,"p--graphs--graph"),detailBox=listContainer.querySelector(".p--graphs--detailBox");listContainer.removeChild(detailBox)}function attachCircleEvents(){var graphList=document.getElementById("p--graphs");addEvent(graphList,"mouseover",function(event){"circle"===event.target.tagName&&appendDetailBoxForCircle(event.target)}),addEvent(graphList,"mouseout",function(event){"circle"===event.target.tagName&&removeDetailBoxForCircle(event.target)})}function attachEventListeners(){attachCircleEvents()}function drawLineCharts(data){var firstMetric=data[0].metrics;for(var metric in firstMetric)"number"==typeof data[0].metrics[metric]&&drawLineChart(data,metric)}var DURATION=1500;drawLineCharts(window.results),attachEventListeners()}(d3,window,document);